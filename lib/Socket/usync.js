Object.defineProperty(exports,"__esModule",{value:!0});exports.makeUSyncSocket=void 0;
const boom_1=require("@hapi/boom"),WABinary_1=require("../WABinary"),socket_1=require("./socket"),makeUSyncSocket=d=>{d=(0,socket_1.makeSocket)(d);const {generateMessageTag:f,query:g}=d;return{...d,executeUSyncQuery:async a=>{if(0===a.protocols.length)throw new boom_1.Boom("USyncQuery must have at least one protocol");var c={tag:"list",attrs:{},content:a.users.map(b=>({tag:"user",attrs:{jid:b.phone?void 0:b.id},content:a.protocols.map(e=>e.getUserElement(b)).filter(e=>null!==e)}))};const h={tag:"query",
attrs:{},content:a.protocols.map(b=>b.getQueryElement())};c={tag:"iq",attrs:{to:WABinary_1.S_WHATSAPP_NET,type:"get",xmlns:"usync"},content:[{tag:"usync",attrs:{context:a.context,mode:a.mode,sid:f(),last:"true",index:"0"},content:[h,c]}]};c=await g(c);return a.parseUSyncQueryResult(c)}}};exports.makeUSyncSocket=makeUSyncSocket;
