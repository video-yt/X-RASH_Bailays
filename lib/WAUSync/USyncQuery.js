Object.defineProperty(exports,"__esModule",{value:!0});exports.USyncQuery=void 0;const WABinary_1=require("../WABinary"),UsyncBotProfileProtocol_1=require("./Protocols/UsyncBotProfileProtocol"),UsyncLIDProtocol_1=require("./Protocols/UsyncLIDProtocol"),Protocols_1=require("./Protocols");
class USyncQuery{constructor(){this.protocols=[];this.users=[];this.context="interactive";this.mode="query"}withMode(a){this.mode=a;return this}withContext(a){this.context=a;return this}withUser(a){this.users.push(a);return this}parseUSyncQueryResult(a){if("result"===a.attrs.type){var g=Object.fromEntries(this.protocols.map(b=>[b.name,b.parser])),e={list:[],sideList:[]};a=(0,WABinary_1.getBinaryNodeChild)(a,"usync");a=(0,WABinary_1.getBinaryNodeChild)(a,"list");Array.isArray(null===a||void 0===a?
void 0:a.content)&&"undefined"!==typeof a&&(e.list=a.content.map(b=>{const h=null===b||void 0===b?void 0:b.attrs.jid;return{...(Array.isArray(null===b||void 0===b?void 0:b.content)?Object.fromEntries(b.content.map(c=>{const d=c.tag,f=g[d];return f?[d,f(c)]:[d,null]}).filter(([,c])=>null!==c)):{}),id:h}}));return e}}withDeviceProtocol(){this.protocols.push(new Protocols_1.USyncDeviceProtocol);return this}withContactProtocol(){this.protocols.push(new Protocols_1.USyncContactProtocol);return this}withStatusProtocol(){this.protocols.push(new Protocols_1.USyncStatusProtocol);
return this}withDisappearingModeProtocol(){this.protocols.push(new Protocols_1.USyncDisappearingModeProtocol);return this}withBotProfileProtocol(){this.protocols.push(new UsyncBotProfileProtocol_1.USyncBotProfileProtocol);return this}withLIDProtocol(){this.protocols.push(new UsyncLIDProtocol_1.USyncLIDProtocol);return this}}exports.USyncQuery=USyncQuery;
